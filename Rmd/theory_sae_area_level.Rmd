# Area Level Models

In SAE mixed models are generally devided into area\hyp{ } und unit\hyp{}level
models. In this section a review of some of the most important results is given
with respect to area\hyp{}level models. Section (?) then presents the basic
unit\hyp{}level model.

## The Fay-Herriot Model

The basic area\hyp{}level model was introduced by @Fay79 and has been used in
applications and is also subject to various extensions. Some of which are
discussed in more detail later. The general setting is that only information on
the area\hyp{}level is available, i.e. direct estimates for the domains. The
model is then built around two stages. The first stage is the sampling model:
$$
\si{\tilde{y}} = \si{\theta} + \si{e}
$$
where $\si{\tilde{y}}$ is a direct estimator for a statistic of interest,
$\si{\theta}$, for an area $i$ with $i = 1, \dots, D$ and $D$ being the number
of areas. The sampling error $\si{e}$ is assumed to be independent and normally
distributed with known variances $\sige$, i.e. $\si{e} \sim \Distr{N}(0,
\sige)$. The model is modified with a second stage, the linking model, by 
assuming a linear relationship between the true area statistic, $\si{\theta}$,
and some diterministic auxiliary variables $\si{\mat{x}}$:
$$
\si{\theta} = \si{\mat{x}}^\top \beta + \si{\re}
$$
where $\si{\mat{x}}$ is a $(P \times 1)$ vector containing area\hyp{}level
information for $P$ variables and $\beta$ is a ($P \times 1$) vector of
regression coefficients. The model errors $\si{\re}$ are assumed to be
independent and identically distributed following a normal distribution: $\re_i
\sim \Distr{N}(0, \sigre)$. Furthermore $e_i$ and $\re_i$ are assumed to be
independent. Combining the sampling and linking model leads to:
\begin{align}
\tilde{y}_i = \si{\mat{x}}^\top \beta + \re_i + e_i \label{eq:FH}
\end{align}

### Best Linear Unbiased Prediction

To obtain small area predictions under model \eq{eq:FH} it can be defined as a 
linear mixed model and a BLUP and EBLUP can be derived. Basically model 
\eq{eq:FH} can be directly viewed as a mixed model as it was introduced in
equation \eq{eq:lmm} where $\mat{Z} = \mat{I}_D$, $\mat{V}_\re =
\sigre\mat{I}_D$ and $\mat{V}_e = \diag(\sigma_{e, 1}^2, \dots, \sigma_{e,
D}^2)$ with $\mat{I}_D$ being a $(D\times D)$ identity matrix. The vector of
unknown variance parameter in this case is a scalar, such that $\delta = \sigre$
since $\sige$ is assumed to be known. The BLUP, defined in equation
\eq{eq:blup}, for the Fay-Herriot model can then be obtained by setting
$\tilde{\mu}_i = \tilde{\theta}_i^{FH}$,
$\mat{l}_i^\top = \mat{x}_i^\top$, $\mat{m}^\top_i = 1$ and $y_i = \tilde{y}_i$:
\empty{
\begin{align}
\tilde{\theta}_i^{FH} = 
\tilde{\theta}_i^{FH}(\sigma_\re^2) &= \si{\mat{x}}^\top\tilde{\beta} + \si{\tilde{\re}} \nonumber\\
                              &= \si{\mat{x}}^\top\tilde{\beta} + \frac{\sigma_\re^2}{\sigma_\re^2 + \sige} \Paran{\tilde{y}_i - \si{\mat{x}}^\top\tilde{\beta}} \nonumber\\
                              &= \gamma_i\tilde{y}_i + (1 - \gamma_i)\si{\mat{x}}^\top\tilde{\beta}
\end{align}
}with $\si{\gamma} = \sigre / (\sigre + \sige)$. The BLUP depends on the
variance parameter of the random effects, $\sigre$, which is unknown. To obtain
the EBLUP under the Fay-Herriot model we can replace the unknown parameter with
an estimate leading to:
$$
\si{\hat{\theta}}^{FH} = \si{\hat{\gamma}}\si{\tilde{y}} + \Paran{1 - \si{\hat{\gamma}}} \si{\mat{x}}^\top\hat{\beta}
$$
where $\si{\hat{\gamma}} = \hat{\sigma}_\re^2 / (\hat{\sigma}_\re^2 + \sige)$.
Note that the regression parameters are still estimated using the weighted least
squares estimator of equation \eq{eq:blue} with $\delta =
\hat{\sigma}_\re^2$. For the estimation of $\sigre$ different approaches exist.
@Fay79 proposed a moment estimator from which they derived an algorithm to 
  estimate $\sigre$. @Rao03[118-119] reviews several other ideas. Also based on 
  a moment estimator he derives the estimator also used in @Pra90. Both moment 
  estimators have the property that they do not rely on a normal distribution, 
  which is also true for the estimation of the regression coefficients. 
  Alternatively $\sigre$ can be estimated using maximum likelihood or 
  restricted maximum likelihood, which, in contrast, relies on the distributional 
  assumptions. For details see also @Dat00.


### Mean Squared Prediction Error

The MSPE of the EBLUP under the Fay-Herriot model, $\si{\hat{\theta}}^{FH}$, is
subject of several studies. However, it needs to be noted that, interestingly,
@Fay79 did not asses the qunatification of uncertainty associated with their
predictions. In principle the MSPE can be defined for an EBLUP as it was
discussed in section \ref{sec:eblup_mspe}. @Dat05 study the MSPE estimation
using the results of @Pra90 for different estimations of the variance component
$\sigre$. They compare the method of moment method by @Pra90 with the original
estimator by @Fay79 and the maximum likelihood estimator by @Dat00. The main
finding is that regarding the properties of the MSPE estimation the estimator by
@Fay79 performs best overall.

A jackknife MSPE estimator for linear mixed models was introduced by @Jia02 and
later subject to several refinements; see for example @Che03. @Che08 then
introduced a jackknife estimator based on the results of @Jia02 and explicitly
targeted the MSPE estimation of the prediction under a Fay-Herriot model. They
find satisfying results for the MSPE estimation using their method, however, the
conclusion with respect to the estimation of $\sigre$ is not as clear as by
@Dat05, when they compare a method of moment estimator to the method proposed by
@Fay79.

A different line of discussion is stimulated by the fact that it is assumed that
the sampling variances, $\sige$, are known parameters. In practice this is not 
the case and these parameters are estimated using the sample data. This can mean
that they are themselfes direct estimators; but if a direct mean is considered 
unreliable then its variance estimation cannot be considered reliable. @Fay79 
used generalized variance functions - see @Wol07[pp. 272 ff] for a discussion of
these methods - instead of direct estimators. @Mai14 suggest instead to shrink
both means and variances to account for the possibly of unstable direct variance
estimates and also provide an estimator of the MSPE of the predictions. 
This approach is based on a Baysian modelling strategy. @You06 provide results
for the case that direct variance estimates are used in a hirarchical Bayes
approach and can account for that extra variability in the MSPE estimation.
Results for an EBLUP based on estimated sampling variances can be found in
@Wan03 and @Riv03. @Wan03 derive an MSPE using asymptotic properties of the
EBLUP. @Riv03 instead extend the results of @Pra90 and add an extra term to
account for the additional variability assciciated to the estimation of direct
sampling variances.

### Remarks

With respect to the Fay-Herriot model \eq{eq:FH} some remarks need to made. A
closely related form is that closely realated to the James-Stein and emperical
Bayes estimator in that:


in Small Area Estimation play an important role in the
production of reliable domain estimates.

- They can be used even if unit level observations are not accessible. 
- In a model based estimation it is largely unsolved to incorporate design
weights. Area level models can be used to start from a direct design based
estimator.
- Unit level models often have problems with heterogeneity. An assumption, for
example, for unit level data is that the error terms of a model are
homescedastic given the random effects. This assumption is often not plausible
and may call for more complex assumptions on the variance structure of the data.
However such structures may or may not be known and cannot be modelled easily.
This can also lead to computationally demanding procedures.

Given these considerations the most important factor to choose cadidate models
is the availability of data. Very often there is not much of a choice but rather
a decission given the available information. And given the availability of unit
level data, the obvious choice is to consider a model which can use such
information. Only if that fails for one of the above reasons can an area level
model be of interest.


## Spatio-Temporal Fay Harriot model

The model stated in equation \ref{eq:FH} has been modified for including
historical information by modelling autocorrelated model errors and also by
allowing for spatial correlation (in the model error). See the discussion in
@Mar13 for more details. @Mar13 allow for both spatial and temporal correlation
in the model errors. Hence the sampling model is (simply) extended to include
historical information:
$$
y_{dt} = \mu_{dt} + e_{dt},
$$
with $d = 1, \dots, D$ and $t = 1, \dots, T$ where $D$ and $T$ are the total
number of areas and time periods respectively. Here $e_{dt} \sim \mathit{N}(0,
\sigma^2_{dt})$ are independent with known variances $\sigma_{dt}^2$. The model
error is composed of a spatial autoregressive process of order 1 (SAR(1)) and an
autoregressive process of order 1 (AR(1)):
$$
\mu_{dt} = x^\top_{dt}\beta + u_{1d} + u_{2dt},
$$
where $u_{1d}$ and $u_{2dt}$ follow a SAR(1) and AR(1) respectively:
$$
u_{1d} = \rho_1 \sum_{l\neq d}w_{d,l} u_{1l} + \epsilon_{1d},
$$
where $|\rho_1| < 1$ and $\epsilon_{1d} \sim \mathit{N}(0, \sigma_1^2)$ are
i.i.d. with $d = 1,\dots, D$. $w_{d, l}$ are the elements of $W$ which is the
row standardized proximity matrix $W^0$. The elements in $W^0$ are equal to 1 if
areas are neighboured and 0 otherwise (an area is not neighboured with itself) -
thus the dimension of $W^0$ is $D\times D$. As stated above $u_{2dt}$ follows an
AR(1):
$$
u_{2dt} = \rho_2 u_{2d, t-1} + \epsilon_{2dt},
$$
where $|\rho_2| < 1$ and $\epsilon_{2dt} \sim \mathit{N}(0, \sigma_2^2)$ are
i.i.d. with $d = 1, \dots, D$ and $t = 1, \dots, T$. Note that $u_{1d}$ and
$u_{2dt}$ and $e_{dt}$ are independent and the sampling error variance
parameters are assumed to be known. The model can then be stated as:
$$
\mathbf{y} = \mathbf{X}\beta + \mathbf{Z}\mathbf{u} + \mathbf{e},
$$
where $\mathbf{y}$ is the $DT\times 1$ vector containing $y_{dt}$ as elements,
$\mathbf{X}$ is the $DT \times p$ design matrix containing the vectors
$x^\top_{dt}$ as rows, $\mathbf{u}$ is the $(D + DT) \times 1$ vector of model
errors and $\mathbf{e}$ the $DT \times 1$ vector of sampling errors $e_{dt}$.
Note that $\mathbf{u} = (u_1^\top, u_2^\top)$ where the $D\times 1$ vector $u_1$
and $DT \times 1$ vector $u_2$ have $u_{1d}$ and $u_{2dt}$ as elements
respectively. Furthermore $\mathbf{Z} = (\mathbf{Z}_1, \mathbf{Z}_2)$ has
dimension $DT \times (D+DT)$, where $\mathbf{Z}_1 = \mathbf{I}_D \otimes
\mathbf{1}_T$ ($\mathbf{I}_D$ denotes a $D\times D$ identity matrix and
$\mathbf{1}_T$ a $1 \times T$ vector of ones) has dimension $DT \times D$ and
$\mathbf{Z}_2$ is a $DT \times DT$ identity matrix.

Concerning the variance of $\mathbf{y}$ first consider the distributions of all
error components. $\mathbf{e} \sim \mathit{N}(\mathbf{0}, \mathbf{V}_e)$ where
$\mathbf{V}_e$ is a diagonal matrix with the known $\sigma^2_{dt}$ on the main
diagonal. $\mathbf{u} \sim \mathit{N}(\mathbf{0}, \mathbf{V}_u(\theta))$ with
the block diagonal covariance matrix $\mathbf{V}_u(\theta) =
\text{diag}(\sigma_1^2\Omega_1(\rho_1), \sigma_2^2\Omega_2(\rho_2))$ where
$\theta = (\sigma_1^2, \rho_1, \sigma_2^2, \rho_2)$.

$$
\Omega_1(\rho_1) = \left((\mathbf{I}_D - \rho_1\mathbf{W})^\top (\mathbf{I}_D - \rho_1\mathbf{W})\right)^{-1}
$$
and follows from the SAR(1) process in the model errors. $\Omega_2(\rho_2)$ has
a block diagonal structure with $\Omega_{2d}(\rho_2)$ denoting the blocks where
the definition of $\Omega_{2d}(\rho_2)$ follows from the AR(1) process:
  $$
    \Omega_{2d}(\rho_2) = \frac{1}{1-\rho_2^2}
    \left(
      \begin{matrix}
      1 & \rho_2 & \cdots & \rho_2^{T-2}& \rho_2^{T-1}\\
      \rho_2 & 1 & & & \rho_2^{T-2} \\
      \vdots & & \ddots & & \vdots \\
      \rho_2^{T-2} &&& 1 & \rho_2 \\
      \rho_2^{T-1} & \rho_2^{T-2} & \cdots & \rho_2 & 1\\
      \end{matrix}
      \right)_{T\times T}
  $$
The variance of $\mathbf{y}$ can thus be stated as:
$$
\mathbb{V}(\mathbf{y}) = \mathbf{V}(\theta) = \mathbf{Z}\mathbf{V}_u(\theta)\mathbf{Z}^\top + \mathbf{V}_e
$$
The BLUE of $\beta$ and BLUP of $\theta$ can be stated as \citep[see][]{Hen75}:
$$
\tilde{\beta}(\theta) = \left(\mathbf{X}^\top \mathbf{V}^{-1}(\theta) \mathbf{X} \right)^{-1} \mathbf{X}^\top \mathbf{V}^{-1}(\theta) \mathbf{y}
$$
$$
\tilde{u}(\theta) = \mathbf{V}_u(\theta) \mathbf{Z}^\top \mathbf{V}^{-1}(\theta) \left(\mathbf{y} - \mathbf{X}\tilde{\beta}(\theta)\right)
$$
Hence the BLUP of $u_1$ and $u_2$ can be stated as:
$$
\tilde{u}_1(\theta) = \sigma_1^2 \Omega_1(\rho_1) \mathbf{Z}^\top \mathbf{V}^{-1}(\theta) \left(\mathbf{y} - \mathbf{X}\tilde{\beta}(\theta)\right)
$$
$$
\tilde{u}_2(\theta) = \sigma_2^2 \Omega_2(\rho_2) \mathbf{Z}^\top \mathbf{V}^{-1}(\theta) \left(\mathbf{y} - \mathbf{X}\tilde{\beta}(\theta)\right)
$$
Estimating $\theta$ leads to the EBLUE for $\beta$ and EBLUPs for $u_1$ and
$u_2$, hence an predictor for the area characteristic $\mu_{dt}$ is given by:
$$
\hat{\mu}_{dt} = x_{dt}^\top \hat{\beta} + \hat{u}_{1d} + \hat{u}_{2dt}
$$
@Mar13 use a restricted maximum likelihood method to estimate $\theta$
  independently of $\beta$. An open question is if this approach can be applied
  for the robust spatio-temporal model. Thus we will continue with the
  discussion of robust small area methods.


## From Unit to Area Level Models



In later simulation studies we will consider data in which area level statistics
are computed from individual information. From a contextual point of view, 
starting from individual information is advantageous in the sense that outlying 
areas can be motivated more easily. Also the question for a good estimator for 
the sampling variances can be motivated when knowing the underlying individual 
model. Hence, I will derive the Fay-Herriot model starting from unit-level. 
Consider the following model:
$$
\sij{y} = x_i^\top\beta + \re + e_i \text{ ,}
$$
where $\sij{y}$ is the response in domain $i$ of unit $j$ with $i = 1, \dots,
\si{n}$, where $\si{n}$ is the number of units in domain $i$. $\re$ is an area
specific random effect following (i.i.d.) a normal distribution with zero mean
and $\sigre$ as variance parameter. $\sij{e}$ is the remaining deviation from
the model, following (i.i.d.) a normal distribution with zero mean and $\sige$
as variance parameter. This unit level model is defined under strong
assumptions, still, assumptions most practitioner are willing to make which
could simplify the identification of the sampling variances under the area level
model.

From this model consider the area statistics $\tilde{y}_i = \frac{1}{n_j}
\sum_{j = 1}^{\si{n}}\sij{y}$, for which an area level model can be derived as:
$$
\tilde{y}_i = \si{x}^\top\beta + \si{\re} + \si{e}
$$
Considering the mean in a linear model, it can be expressed as $\bar{y} = 
\bar{x}\beta$; the random effect was defined for each area, hence it remains 
unaltered for the area level model. The error term in this model can be 
expressed as the sampling error and its standard deviation as the (conditional) 
standard deviation of the aggregated area statistic, which in this case is a 
mean. Hence, $\si{e} \sim \Distr{N}(0, \sige = \sigma^2_e / \si{n})$. Under this
unit level model a sufficient estimator for $\sige$ can be derived from
estimating $\sige$, which can be done robust and non-robust in many ways.




- Namazi-Rad / Steel (2015): *What Level of Statistical Model Should We Use
    in Small Area Estimation?*, Australian Journal of Statistics
    - Area Level vs. Unit Level Models. Main finding: When a model with
        contextual variables is the population model, using a area level model
        better than a unit level without contextual variables.
- Chandra, Sud and Gharde (2014): Small Area Estimation Using Estimated Population Level Auxiliary Data

- You and Chapman (2006): Small Area Estimation Using Area Level Models and Estimated Sampling Variances
- Rivest, Vandal (): Mean Squared Error Estimation for Small Areas when the Small Area Variances Are Estimated
- Chen and Lahiri (2008): On Mean Squared Prediction Error Estimation in Small Area Estimation Problems
- Wang and Fuller (2003): The Mean Squared Error of Small Area Predictors Constructed With Estimated Area Variances
- Datta, Rao Smith: On measuring the variability of small area estimators under a basic area level model

- Porter, Holan, Wikle, Cressie (2014): Spatial Fay-Herriot models for small area estimation with functional covariates
- López-Vizcaíno, Lombardía and Morales (2015): Small area estimation of labour force indicators under multinomial models with correlated time and area effects
- Rao and Yu (1994): Small-Area Estimation by Combining Time-Series and Cross-Sectional Data
- Benedetti, Pratesi and Salvati (2013): Local stationarity in small area estimation models

- Sugasawa et.al. (2015): Bayesian Estimators for Small Area Models Shrinking Both Means and Variances

- Sugasawa and Kubokawa (2015): Parametric transformed Fay-Herriot model for small area estimation
- Sugasawa and Kubokawa (2015): Transforming Response Values in Small Area Prediction
- Benavent and Morales (2015): Multivariate Fay-Herriot models for small area estimation




